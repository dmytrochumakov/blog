<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Combine — Basics | Dmytro&#39;s Blog</title>
<meta name="keywords" content="Combine">
<meta name="description" content="What is Combine?
Combine Framework provides an API for processing async events over time such as user-input, network response, and other dynamic data.
What is the purpose of Combine?
The purpose of Combine is to simplify the management of async events and data streams.
Publishers
Publisher declares that a type can transit a sequence of values over time. A publisher delivers elements to one or more Subscriber instances.
class PostService {
    func fetchPosts() -&gt; AnyPublisher&lt;[Post], Error&gt; {
        guard let url = URL(string: &#34;https://jsonplaceholder.typicode.com/posts&#34;) else {
            fatalError(&#34;Invalid URL&#34;)
        }
        return URLSession.shared.dataTaskPublisher(for: url)
            .map(\.data)
            .decode(type: [Post].self, decoder: JSONDecoder())
            .receive(on: DispatchQueue.main)
            .eraseToAnyPublisher()
    }
}
Subscribers
Subscriber is a protocol that declares a type that can receive input from a publisher.
A Subscriber instance receives a stream of elements from a Publisher.">
<meta name="author" content="Dmytro Chumakov">
<link rel="canonical" href="http://localhost:1313/posts/combine-basics/">
<meta name="google-site-verification" content="G-HZZ4JTFGDP">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8d4df4fe329d2372424d28ce76581b7279a2220496c292d225bde1c201d0518c.css" integrity="sha256-jU30/jKdI3JCTSjOdlgbcnmiIgSWwpLSJb3hwgHQUYw=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/combine-basics/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><style>
    @media screen and (min-width: 769px) {
         
        .post-content input[type="checkbox"]:checked ~ label > img {
            transform: scale(1.6);
            cursor: zoom-out;
            position: relative;
            z-index: 999;
        }
    
        .post-content img.zoomCheck {
            transition: transform 0.15s ease;
            z-index: 999;
            cursor: zoom-in;
        }
    }
    </style>
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-HZZ4JTFGDP"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-HZZ4JTFGDP');
        }
      </script><meta property="og:url" content="http://localhost:1313/posts/combine-basics/">
  <meta property="og:site_name" content="Dmytro&#39;s Blog">
  <meta property="og:title" content="Combine — Basics">
  <meta property="og:description" content="What is Combine? Combine Framework provides an API for processing async events over time such as user-input, network response, and other dynamic data.
What is the purpose of Combine? The purpose of Combine is to simplify the management of async events and data streams.
Publishers Publisher declares that a type can transit a sequence of values over time. A publisher delivers elements to one or more Subscriber instances.
class PostService { func fetchPosts() -&gt; AnyPublisher&lt;[Post], Error&gt; { guard let url = URL(string: &#34;https://jsonplaceholder.typicode.com/posts&#34;) else { fatalError(&#34;Invalid URL&#34;) } return URLSession.shared.dataTaskPublisher(for: url) .map(\.data) .decode(type: [Post].self, decoder: JSONDecoder()) .receive(on: DispatchQueue.main) .eraseToAnyPublisher() } } Subscribers Subscriber is a protocol that declares a type that can receive input from a publisher. A Subscriber instance receives a stream of elements from a Publisher.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-07T08:29:30+03:00">
    <meta property="article:modified_time" content="2024-02-07T08:29:30+03:00">
    <meta property="article:tag" content="Combine">
      <meta property="og:image" content="http://localhost:1313/images/papermod-cover.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png">
<meta name="twitter:title" content="Combine — Basics">
<meta name="twitter:description" content="What is Combine?
Combine Framework provides an API for processing async events over time such as user-input, network response, and other dynamic data.
What is the purpose of Combine?
The purpose of Combine is to simplify the management of async events and data streams.
Publishers
Publisher declares that a type can transit a sequence of values over time. A publisher delivers elements to one or more Subscriber instances.
class PostService {
    func fetchPosts() -&gt; AnyPublisher&lt;[Post], Error&gt; {
        guard let url = URL(string: &#34;https://jsonplaceholder.typicode.com/posts&#34;) else {
            fatalError(&#34;Invalid URL&#34;)
        }
        return URLSession.shared.dataTaskPublisher(for: url)
            .map(\.data)
            .decode(type: [Post].self, decoder: JSONDecoder())
            .receive(on: DispatchQueue.main)
            .eraseToAnyPublisher()
    }
}
Subscribers
Subscriber is a protocol that declares a type that can receive input from a publisher.
A Subscriber instance receives a stream of elements from a Publisher.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Combine — Basics",
      "item": "http://localhost:1313/posts/combine-basics/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Combine — Basics",
  "name": "Combine — Basics",
  "description": "What is Combine? Combine Framework provides an API for processing async events over time such as user-input, network response, and other dynamic data.\nWhat is the purpose of Combine? The purpose of Combine is to simplify the management of async events and data streams.\nPublishers Publisher declares that a type can transit a sequence of values over time. A publisher delivers elements to one or more Subscriber instances.\nclass PostService { func fetchPosts() -\u0026gt; AnyPublisher\u0026lt;[Post], Error\u0026gt; { guard let url = URL(string: \u0026#34;https://jsonplaceholder.typicode.com/posts\u0026#34;) else { fatalError(\u0026#34;Invalid URL\u0026#34;) } return URLSession.shared.dataTaskPublisher(for: url) .map(\\.data) .decode(type: [Post].self, decoder: JSONDecoder()) .receive(on: DispatchQueue.main) .eraseToAnyPublisher() } } Subscribers Subscriber is a protocol that declares a type that can receive input from a publisher. A Subscriber instance receives a stream of elements from a Publisher.\n",
  "keywords": [
    "Combine"
  ],
  "articleBody": "What is Combine? Combine Framework provides an API for processing async events over time such as user-input, network response, and other dynamic data.\nWhat is the purpose of Combine? The purpose of Combine is to simplify the management of async events and data streams.\nPublishers Publisher declares that a type can transit a sequence of values over time. A publisher delivers elements to one or more Subscriber instances.\nclass PostService { func fetchPosts() -\u003e AnyPublisher\u003c[Post], Error\u003e { guard let url = URL(string: \"https://jsonplaceholder.typicode.com/posts\") else { fatalError(\"Invalid URL\") } return URLSession.shared.dataTaskPublisher(for: url) .map(\\.data) .decode(type: [Post].self, decoder: JSONDecoder()) .receive(on: DispatchQueue.main) .eraseToAnyPublisher() } } Subscribers Subscriber is a protocol that declares a type that can receive input from a publisher. A Subscriber instance receives a stream of elements from a Publisher.\nprivate var cancellable: AnyCancellable? let service = PostService() cancellable = service.fetchPosts() .sink(receiveCompletion: { completion in switch completion { case .finished: break case .failure(let error): print(error.localizedDescription) } }, receiveValue: { posts in print(\"Received posts count:\", posts.count) }) AnyCancellable When you call a method like sink or assign on a publisher, it returns a type that conforms to the Cancellable protocol. Storing this return value in an instance of AnyCancellable keeps the subscription active. When the AnyCancellable instance is deallocated, its deinit method automatically cancels the subscription.\nvar cancellables = Set\u003cAnyCancellable\u003e() let publisher = Just(\"Hello, Combine!\") publisher .sink { completion in print(\"Completion: \\(completion)\") } receiveValue: { value in print(\"Received value: \\(value)\") } .store(in: \u0026cancellables) Operators Transforming Operators map: Transforms each value received from a publisher by applying a function. flatMap: Transforms each value received into a new publisher, then flattens the result into a single publisher stream. scan: Applies a closure over the previous result and the current value to produce a new value, useful for accumulating values. Filtering Operators filter: Emits only those values from a publisher that satisfy a given predicate. removeDuplicates: Suppresses duplicate consecutive values published by a publisher. first/last: Emits only the first or last value from a publisher that satisfies a predicate condition. Combining Operators combineLatest: Combines the latest value from two or more publishers and emits a combined value each time any of the publishers emit a value. merge: Combines multiple publishers of the same type into a single publisher stream, emitting values as they arrive. zip: Combines values from multiple publishers into tuples, emitting a tuple only when each of the publishers has emitted a new value. Error Handling Operators catch: Handles errors from a publisher by replacing the failed publisher with another publisher or a value. retry: Attempts to recreate a subscription to a failed publisher for a specified number of times. Utility Operators delay: Delays the emission of items from the publisher for a specified interval. subscribe(on:)/receive(on:): Specifies the dispatch queue for performing subscription work or receiving values. print: Prints log messages for all publisher events to the console, useful for debugging. Timing Operators debounce: Emits a value from a publisher only after a specified time interval has passed without receiving another value. throttle: Emits either the first or last value received in a specified time window. Collecting Operators collect: Collects received values and emits an array of those values either when the publisher completes or when a buffer size is reached. When to use Combine? I found great advice from Apple when it comes to Combine:\n“A Combine publisher fills a role similar to, but distinct from, the AsyncSequence in the Swift standard library. A Publisher and an AsyncSequence both produce elements over time. However, the pull model in Combine uses a Subscriber to request elements from a publisher, while Swift concurrency uses the for-await-in syntax to iterate over elements published by an AsyncSequence. Both APIs offer methods to modify the sequence by mapping or filtering elements, while only Combine provides time-based operations like debounce(for:scheduler:options:) and throttle(for:scheduler:latest:), and combining operations like merge(with:) and combineLatest(_:_:). To bridge the two approaches, the property values exposes a publisher’s elements as an AsyncSequence, allowing you to iterate over them with for-await-in rather than attaching a Subscriber.”\nThank you for reading!\n",
  "wordCount" : "672",
  "inLanguage": "en",
  "image": "http://localhost:1313/images/papermod-cover.png","datePublished": "2024-02-07T08:29:30+03:00",
  "dateModified": "2024-02-07T08:29:30+03:00",
  "author":{
    "@type": "Person",
    "name": "Dmytro Chumakov"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/combine-basics/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Dmytro's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Dmytro&#39;s Blog (Alt + H)">Dmytro&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                </ul>
            </div>
        </div>

        
        <button id="menu-trigger" aria-haspopup="menu" aria-label="Menu Button">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>
        <ul class="menu hidden">
            <li>
                <a href="http://localhost:1313/newsletter/" title="Newsletter">
                    <span>Newsletter</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Combine — Basics
    </h1>
    <div class="post-meta"><span title='2024-02-07 08:29:30 +0300 +0300'>February 7, 2024</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Dmytro Chumakov

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#what-is-combine" aria-label="What is Combine?">What is Combine?</a></li>
                <li>
                    <a href="#what-is-the-purpose-of-combine" aria-label="What is the purpose of Combine?">What is the purpose of Combine?</a></li>
                <li>
                    <a href="#publishers" aria-label="Publishers">Publishers</a></li>
                <li>
                    <a href="#subscribers" aria-label="Subscribers">Subscribers</a></li>
                <li>
                    <a href="#anycancellable" aria-label="AnyCancellable">AnyCancellable</a></li>
                <li>
                    <a href="#operators" aria-label="Operators">Operators</a></li>
                <li>
                    <a href="#transforming-operators" aria-label="Transforming Operators">Transforming Operators</a></li>
                <li>
                    <a href="#filtering-operators" aria-label="Filtering Operators">Filtering Operators</a></li>
                <li>
                    <a href="#combining-operators" aria-label="Combining Operators">Combining Operators</a></li>
                <li>
                    <a href="#error-handling-operators" aria-label="Error Handling Operators">Error Handling Operators</a></li>
                <li>
                    <a href="#utility-operators" aria-label="Utility Operators">Utility Operators</a></li>
                <li>
                    <a href="#timing-operators" aria-label="Timing Operators">Timing Operators</a></li>
                <li>
                    <a href="#collecting-operators" aria-label="Collecting Operators">Collecting Operators</a></li>
                <li>
                    <a href="#when-to-use-combine" aria-label="When to use Combine?">When to use Combine?</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h3 id="what-is-combine">What is Combine?<a hidden class="anchor" aria-hidden="true" href="#what-is-combine">#</a></h3>
<p>Combine Framework provides an API for processing async events over time such as user-input, network response, and other dynamic data.</p>
<h3 id="what-is-the-purpose-of-combine">What is the purpose of Combine?<a hidden class="anchor" aria-hidden="true" href="#what-is-the-purpose-of-combine">#</a></h3>
<p>The purpose of Combine is to simplify the management of async events and data streams.</p>
<h3 id="publishers">Publishers<a hidden class="anchor" aria-hidden="true" href="#publishers">#</a></h3>
<p><a href="https://developer.apple.com/documentation/combine/publisher"><code>Publisher</code></a> declares that a type can transit a sequence of values over time. A publisher delivers elements to one or more <a href="https://developer.apple.com/documentation/combine/subscriber"><code>Subscriber</code></a> instances.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">PostService</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">fetchPosts</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="n">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="n">Post</span><span class="p">],</span> <span class="n">Error</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">guard</span> <span class="kd">let</span> <span class="nv">url</span> <span class="p">=</span> <span class="n">URL</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="s">&#34;https://jsonplaceholder.typicode.com/posts&#34;</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="bp">fatalError</span><span class="p">(</span><span class="s">&#34;Invalid URL&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">URLSession</span><span class="p">.</span><span class="n">shared</span><span class="p">.</span><span class="n">dataTaskPublisher</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="bp">map</span><span class="p">(</span><span class="err">\</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="n">type</span><span class="p">:</span> <span class="p">[</span><span class="n">Post</span><span class="p">].</span><span class="kc">self</span><span class="p">,</span> <span class="n">decoder</span><span class="p">:</span> <span class="n">JSONDecoder</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">receive</span><span class="p">(</span><span class="n">on</span><span class="p">:</span> <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">eraseToAnyPublisher</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="subscribers">Subscribers<a hidden class="anchor" aria-hidden="true" href="#subscribers">#</a></h3>
<p><a href="https://developer.apple.com/documentation/combine/subscriber"><code>Subscriber</code></a> is a protocol that declares a type that can receive input from a publisher.
A Subscriber instance receives a stream of elements from a Publisher.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">private</span> <span class="kd">var</span> <span class="nv">cancellable</span><span class="p">:</span> <span class="n">AnyCancellable</span><span class="p">?</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">service</span> <span class="p">=</span> <span class="n">PostService</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">cancellable</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">fetchPosts</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">completion</span> <span class="k">in</span>
</span></span><span class="line"><span class="cl">        <span class="k">switch</span> <span class="n">completion</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="p">.</span><span class="n">finished</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="p">.</span><span class="n">failure</span><span class="p">(</span><span class="kd">let</span> <span class="nv">error</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="bp">print</span><span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">localizedDescription</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">posts</span> <span class="k">in</span>
</span></span><span class="line"><span class="cl">        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;Received posts count:&#34;</span><span class="p">,</span> <span class="n">posts</span><span class="p">.</span><span class="bp">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span></code></pre></div><h3 id="anycancellable">AnyCancellable<a hidden class="anchor" aria-hidden="true" href="#anycancellable">#</a></h3>
<p>When you call a method like <a href="https://developer.apple.com/documentation/combine/publisher/sink%28receivecompletion:receivevalue:%29"><code>sink</code></a> or <a href="https://developer.apple.com/documentation/combine/publisher/assign%28to:on:%29"><code>assign</code></a> on a publisher, it returns a type that conforms to the <a href="https://developer.apple.com/documentation/combine/cancellable/"><code>Cancellable</code></a> protocol. Storing this return value in an instance of <a href="https://developer.apple.com/documentation/combine/anycancellable/"><code>AnyCancellable</code></a> keeps the subscription active. When the AnyCancellable instance is deallocated, its deinit method automatically cancels the subscription.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nv">cancellables</span> <span class="p">=</span> <span class="n">Set</span><span class="p">&lt;</span><span class="n">AnyCancellable</span><span class="p">&gt;()</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">publisher</span> <span class="p">=</span> <span class="n">Just</span><span class="p">(</span><span class="s">&#34;Hello, Combine!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">publisher</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">completion</span> <span class="k">in</span>
</span></span><span class="line"><span class="cl">        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;Completion: </span><span class="si">\(</span><span class="n">completion</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
</span></span><span class="line"><span class="cl">        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;Received value: </span><span class="si">\(</span><span class="n">value</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">cancellables</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="operators">Operators<a hidden class="anchor" aria-hidden="true" href="#operators">#</a></h3>
<h3 id="transforming-operators">Transforming Operators<a hidden class="anchor" aria-hidden="true" href="#transforming-operators">#</a></h3>
<ul>
<li><a href="https://developer.apple.com/documentation/combine/publishers/catch/map%28_:%29-6vw93"><code>map</code></a>: Transforms each value received from a publisher by applying a function.</li>
<li><a href="https://developer.apple.com/documentation/combine/publishers/catch/flatmap%28maxpublishers:_:%29-9nww4"><code>flatMap</code></a>: Transforms each value received into a new publisher, then flattens the result into a single publisher stream.</li>
<li><a href="https://developer.apple.com/documentation/combine/publishers/catch/scan%28_:_:%29"><code>scan</code></a>: Applies a closure over the previous result and the current value to produce a new value, useful for accumulating values.</li>
</ul>
<h3 id="filtering-operators">Filtering Operators<a hidden class="anchor" aria-hidden="true" href="#filtering-operators">#</a></h3>
<ul>
<li><a href="https://developer.apple.com/documentation/combine/publishers/catch/filter%28_:%29"><code>filter</code></a>: Emits only those values from a publisher that satisfy a given predicate.</li>
<li><a href="https://developer.apple.com/documentation/combine/publishers/catch/removeduplicates%28%29"><code>removeDuplicates</code></a>: Suppresses duplicate consecutive values published by a publisher.</li>
<li><a href="https://developer.apple.com/documentation/combine/publishers/catch/last%28%29"><code>first/last</code></a>: Emits only the first or last value from a publisher that satisfies a predicate condition.</li>
</ul>
<h3 id="combining-operators">Combining Operators<a hidden class="anchor" aria-hidden="true" href="#combining-operators">#</a></h3>
<ul>
<li><a href="https://developer.apple.com/documentation/combine/publishers/catch/combinelatest%28_:_:%29-2s61"><code>combineLatest</code></a>: Combines the latest value from two or more publishers and emits a combined value each time any of the publishers emit a value.</li>
<li><a href="https://developer.apple.com/documentation/combine/publishers/catch/merge%28with:%29"><code>merge</code></a>: Combines multiple publishers of the same type into a single publisher stream, emitting values as they arrive.</li>
<li><a href="https://developer.apple.com/documentation/combine/publishers/catch/zip%28_:%29"><code>zip</code></a>: Combines values from multiple publishers into tuples, emitting a tuple only when each of the publishers has emitted a new value.</li>
</ul>
<h3 id="error-handling-operators">Error Handling Operators<a hidden class="anchor" aria-hidden="true" href="#error-handling-operators">#</a></h3>
<ul>
<li><a href="https://developer.apple.com/documentation/combine/publishers/catch/catch%28_:%29"><code>catch</code></a>: Handles errors from a publisher by replacing the failed publisher with another publisher or a value.</li>
<li><a href="https://developer.apple.com/documentation/combine/publishers/catch/retry%28_:%29"><code>retry</code></a>: Attempts to recreate a subscription to a failed publisher for a specified number of times.</li>
</ul>
<h3 id="utility-operators">Utility Operators<a hidden class="anchor" aria-hidden="true" href="#utility-operators">#</a></h3>
<ul>
<li><a href="https://developer.apple.com/documentation/combine/publishers/catch/delay%28for:tolerance:scheduler:options:%29"><code>delay</code></a>: Delays the emission of items from the publisher for a specified interval.</li>
<li><a href="https://developer.apple.com/documentation/combine/publishers/catch/receive%28on:options:%29"><code>subscribe(on:)/receive(on:)</code></a>: Specifies the dispatch queue for performing subscription work or receiving values.</li>
<li><a href="https://developer.apple.com/documentation/combine/publishers/catch/print%28_:to:%29"><code>print</code></a>: Prints log messages for all publisher events to the console, useful for debugging.</li>
</ul>
<h3 id="timing-operators">Timing Operators<a hidden class="anchor" aria-hidden="true" href="#timing-operators">#</a></h3>
<ul>
<li><a href="https://developer.apple.com/documentation/combine/publishers/catch/debounce%28for:scheduler:options:%29"><code>debounce</code></a>: Emits a value from a publisher only after a specified time interval has passed without receiving another value.</li>
<li><a href="https://developer.apple.com/documentation/combine/publishers/catch/throttle%28for:scheduler:latest:%29"><code>throttle</code></a>: Emits either the first or last value received in a specified time window.</li>
</ul>
<h3 id="collecting-operators">Collecting Operators<a hidden class="anchor" aria-hidden="true" href="#collecting-operators">#</a></h3>
<ul>
<li><a href="https://developer.apple.com/documentation/combine/publishers/catch/collect%28%29"><code>collect</code></a>: Collects received values and emits an array of those values either when the publisher completes or when a buffer size is reached.</li>
</ul>
<h3 id="when-to-use-combine">When to use Combine?<a hidden class="anchor" aria-hidden="true" href="#when-to-use-combine">#</a></h3>
<p>I found great <a href="https://developer.apple.com/documentation/combine/publisher">advice</a> from Apple when it comes to Combine:</p>
<blockquote>
<p>“A Combine publisher fills a role similar to, but distinct from, the <code>AsyncSequence</code> in the Swift standard library. A <code>Publisher</code> and an <code>AsyncSequence</code> both produce elements over time. However, the pull model in Combine uses a <code>Subscriber</code> to request elements from a publisher, while Swift concurrency uses the for-await-in syntax to iterate over elements published by an <code>AsyncSequence</code>. Both APIs offer methods to modify the sequence by mapping or filtering elements, while only Combine provides time-based operations like <code>debounce(for:scheduler:options:)</code> and <code>throttle(for:scheduler:latest:)</code>, and combining operations like <code>merge(with:)</code> and <code>combineLatest(_:_:)</code>. To bridge the two approaches, the property values exposes a publisher’s elements as an <code>AsyncSequence</code>, allowing you to iterate over them with <code>for-await-in</code> rather than attaching a <code>Subscriber</code>.”</p></blockquote>
<p>Thank you for reading!</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/combine/">Combine</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/big-o-notation/">
    <span class="title">« Prev</span>
    <br>
    <span>Big O notation</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/modern-concurrency/">
    <span class="title">Next »</span>
    <br>
    <span>Modern Concurrency</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Combine — Basics on x"
            href="https://x.com/intent/tweet/?text=Combine%20%e2%80%94%20Basics&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fcombine-basics%2f&amp;hashtags=Combine">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Combine — Basics on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fcombine-basics%2f&amp;title=Combine%20%e2%80%94%20Basics&amp;summary=Combine%20%e2%80%94%20Basics&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fcombine-basics%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Combine — Basics on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fcombine-basics%2f&title=Combine%20%e2%80%94%20Basics">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Combine — Basics on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fcombine-basics%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Combine — Basics on whatsapp"
            href="https://api.whatsapp.com/send?text=Combine%20%e2%80%94%20Basics%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fcombine-basics%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Combine — Basics on telegram"
            href="https://telegram.me/share/url?text=Combine%20%e2%80%94%20Basics&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fcombine-basics%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Combine — Basics on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Combine%20%e2%80%94%20Basics&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fcombine-basics%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer><div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'dmytros-blog';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Dmytro&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><script>
    
    
    let b = document.querySelector("#menu-trigger")
    let m = document.querySelector(".menu")
    b.addEventListener("click", function () {
        m.classList.toggle("hidden")
    });
    
    document.body.addEventListener('click', function (event) {
        if (!b.contains(event.target)) {
            m.classList.add("hidden")
        }
    });
    
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
